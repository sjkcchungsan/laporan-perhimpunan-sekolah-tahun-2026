<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Laporan SJKC Chung San</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        /* Gaya umum untuk skrin */
        body { font-family: Arial, sans-serif; background-color: #f0f2f5; margin: 0; padding: 10px; }
        .container { display: flex; flex-direction: column; gap: 20px; }
        
        @media (min-width: 992px) {
            .container { flex-direction: row; align-items: flex-start; }
            .form-area { width: 35%; position: sticky; top: 10px; max-height: 95vh; overflow-y: auto; }
            .preview-area { width: 65%; }
        }

        .form-area { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        label { font-weight: bold; display: block; margin-top: 15px; font-size: 0.9rem; }
        input, textarea, select { width: 100%; padding: 12px; margin-top: 5px; border: 1px solid #ccc; border-radius: 6px; box-sizing: border-box; font-size: 1rem; }
        ::placeholder { color: #a9a9a9; }

        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .btn-blue { background-color: #3498db; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; flex: 1; font-weight: bold; }
        .btn-green { background-color: #27ae60; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; cursor: pointer; font-size: 1.1rem; font-weight: bold; margin-top: 25px; }

        /* KAWASAN PREVIEW (Hanya untuk paparan di skrin) */
        .preview-area { background: #555; padding: 10px; overflow-x: auto; display: flex; justify-content: center; }

        /* KAWASAN LAPORAN (SAIZ TETAP A4 - PENTING UNTUK TELEFON) */
        #pdf-content { 
            background: white; 
            width: 210mm; 
            min-height: 297mm; 
            padding: 10mm 15mm; 
            box-sizing: border-box; 
            margin: 0;
            flex-shrink: 0; /* Elakkan ia mengecil di telefon */
        }

        /* Kandungan PDF */
        .logo-box { text-align: center; margin: 0 0 5px 0; }
        .logo-box img { max-width: 100px; height: auto; }
        h2 { text-align: center; text-decoration: underline; font-size: 18px; margin: 0 0 15px 0; text-transform: uppercase; }
        
        table { width: 100%; border-collapse: collapse; table-layout: fixed; border: 1px solid black; }
        th, td { border: 1px solid black; padding: 8px; font-size: 13px; word-wrap: break-word; vertical-align: top; }
        th { background-color: #f2f2f2; width: 35%; text-align: left; }

        .photo-page { page-break-before: always; text-align: center; padding-top: 10mm; }
        .photo-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 15px; }
        .img-wrapper { width: 45%; border: 1px solid #000; padding: 5px; background: #fff; box-sizing: border-box; }
        .img-wrapper img { width: 100%; height: 200px; object-fit: contain; display: block; }
    </style>
</head>
<body>

<div class="container">
    <div class="form-area">
        <h3 style="margin:0; color:#2c3e50;">Input Laporan</h3>
        <label>Tarikh</label><input type="date" id="tarikh">
        <label>Hari</label><input type="text" id="hari" placeholder="Auto-isi selepas pilih tarikh">
        <label>Masa Mula</label><input type="text" id="masa" placeholder="0940">

        <label>Senarai Staf (Multi-select)</label>
        <select id="staf" multiple size="8"></select>
        <div class="btn-group">
            <button type="button" class="btn-blue" onclick="selectAllStaf()">Pilih Semua</button>
            <button type="button" class="btn-blue" style="background-color:#95a5a6" onclick="clearStaf()">Reset</button>
        </div>

        <label>Tema Sivik</label>
        <select id="tema">
            <option value="">-- Sila Pilih Tema --</option>
            <option value="Kasih Sayang">Kasih Sayang</option>
            <option value="Hormat-menghormati">Hormat-menghormati</option>
            <option value="Bertanggungjawab">Bertanggungjawab</option>
            <option value="Kegembiraan">Kegembiraan</option>
        </select>

        <label>Nama Pengacara</label><input type="text" id="pengacara" placeholder="Nama Murid / Guru">
        <label>Ucapan Guru Besar</label><textarea id="gb" placeholder="..."></textarea>
        <label>Ucapan GPK Pentadbiran</label><textarea id="gpk_admin" placeholder="..."></textarea>
        <label>Ucapan GPK HEM</label><textarea id="gpk_hem" placeholder="..."></textarea>
        <label>Ucapan GPK Kokurikulum</label><textarea id="gpk_koku" placeholder="..."></textarea>
        <label>Ucapan Staf Lain</label><textarea id="staf_lain" placeholder="..."></textarea>
        
        <label>Disediakan Oleh</label>
        <select id="disediakan">
            <option value="">-- Pilih Nama --</option>
        </select>

        <label>Muat Naik Gambar</label><input type="file" id="inputPhotos" accept="image/*" multiple>

        <button id="btnJana" class="btn-green" onclick="generatePDF()">MUAT TURUN PDF</button>
    </div>

    <div class="preview-area">
        <div id="pdf-content">
            <div class="logo-box"><img src="logo.png" alt="Logo"></div>
            <h2>LAPORAN PERHIMPUNAN MINGGUAN</h2>
            <table>
                <tr><th>Tarikh</th><td id="pvTarikh"></td></tr>
                <tr><th>Hari</th><td id="pvHari"></td></tr>
                <tr><th>Masa Mula</th><td id="pvMasa"></td></tr>
                <tr><th>Kehadiran Guru/Staf</th><td id="pvStaf"></td></tr>
                <tr><th>Tema Sivik</th><td id="pvTema"></td></tr>
                <tr><th>Nama Pengacara</th><td id="pvPengacara"></td></tr>
                <tr><th>Ucapan Guru Besar</th><td id="pvGB"></td></tr>
                <tr><th>Ucapan GPK Pentadbiran</th><td id="pvGPKAdmin"></td></tr>
                <tr><th>Ucapan GPK HEM</th><td id="pvGPKHEM"></td></tr>
                <tr><th>Ucapan GPK Kokurikulum</th><td id="pvGPKKoku"></td></tr>
                <tr><th>Ucapan Staf Lain</th><td id="pvStafLain"></td></tr>
                <tr><th>Disediakan Oleh</th><td id="pvDisediakan"></td></tr>
                <tr><th>Disahkan Oleh</th><td><strong>Ling Lee Ann</strong><br>Guru Besar SJK(C) Chung San</td></tr>
            </table>
            <div id="photo-area" class="photo-page">
                <h3 style="text-decoration: underline; font-size: 16px;">LAMPIRAN GAMBAR</h3>
                <div id="pvPhotos" class="photo-grid"></div>
            </div>
        </div>
    </div>
</div>

<script>
    const stafList = ["Ling Lee Ann","Kong Zhe Fong","Fong Cui Fung","Cynthia Ting Xing Rou","Florence Wong Zhi Yu","Goh Su Ching","Lau Yun Hee","Roland Ting Hock Sing","Sharmaine Daphne Anak Slyvester Bakar","Stephen Hii Yii Nan","Tu Hiong Hiong","Unice Wong Wen Wen","Zafrullah Bin Mohd Sabri","Wong Chui Ling","Claudia Mo Ong Yi","Evy Law Jia Jia","Yuki Ng Jiajing","Wee Chun Yang","Efira Nazation Anak Kennedy","Faizah Binti Othman","Mariani Binti Haili","Stacy Wan"];
    
    const selectStaf = document.getElementById('staf');
    const selectDisediakan = document.getElementById('disediakan');
    const inputTarikh = document.getElementById('tarikh');
    const inputHari = document.getElementById('hari');

    // Isi dropdown staf dan disediakan oleh
    stafList.sort().forEach(s => {
        selectStaf.add(new Option(s, s));
        selectDisediakan.add(new Option(s, s));
    });

    function selectAllStaf() { Array.from(selectStaf.options).forEach(o => o.selected = true); updatePreview(); }
    function clearStaf() { Array.from(selectStaf.options).forEach(o => o.selected = false); updatePreview(); }

    // Fungsi format tarikh & auto-hari
    inputTarikh.addEventListener('change', function() {
        if (this.value) {
            const tarikhObj = new Date(this.value);
            const hariList = ["Ahad", "Isnin", "Selasa", "Rabu", "Khamis", "Jumaat", "Sabtu"];
            inputHari.value = hariList[tarikhObj.getDay()];
        }
        updatePreview();
    });

    function formatTarikhMelayu(dateVal) {
        if (!dateVal) return '-';
        const tarikhObj = new Date(dateVal);
        const bulan = ["Januari", "Februari", "Mac", "April", "Mei", "Jun", "Julai", "Ogos", "September", "Oktober", "November", "Disember"];
        return `${tarikhObj.getDate()} ${bulan[tarikhObj.getMonth()]} ${tarikhObj.getFullYear()}`;
    }

    function updatePreview() {
        document.getElementById('pvTarikh').innerText = formatTarikhMelayu(inputTarikh.value);
        document.getElementById('pvHari').innerText = inputHari.value || '-';
        document.getElementById('pvMasa').innerText = document.getElementById('masa').value || '-';
        document.getElementById('pvTema').innerText = document.getElementById('tema').value || '-';
        document.getElementById('pvPengacara').innerText = document.getElementById('pengacara').value || '-';
        document.getElementById('pvGB').innerText = document.getElementById('gb').value || '-';
        document.getElementById('pvGPKAdmin').innerText = document.getElementById('gpk_admin').value || '-';
        document.getElementById('pvGPKHEM').innerText = document.getElementById('gpk_hem').value || '-';
        document.getElementById('pvGPKKoku').innerText = document.getElementById('gpk_koku').value || '-';
        document.getElementById('pvStafLain').innerText = document.getElementById('staf_lain').value || '-';
        document.getElementById('pvDisediakan').innerText = document.getElementById('disediakan').value || '-';
        
        const sel = Array.from(selectStaf.selectedOptions).map(o => o.value);
        document.getElementById('pvStaf').innerText = sel.length ? sel.join(", ") : "-";
    }

    document.querySelectorAll('input, textarea, select').forEach(el => el.addEventListener('input', updatePreview));

    document.getElementById('inputPhotos').addEventListener('change', async function(e) {
        const container = document.getElementById('pvPhotos');
        container.innerHTML = 'Memproses...';
        const files = Array.from(e.target.files);
        let html = '';
        for (let i = 0; i < files.length; i++) {
            const dataUrl = await new Promise(r => {
                const fr = new FileReader();
                fr.onload = (ev) => r(ev.target.result);
                fr.readAsDataURL(files[i]);
            });
            html += `<div class="img-wrapper"><img src="${dataUrl}"><p style="font-size:11px; margin:5px 0;">Gambar ${i+1}</p></div>`;
        }
        container.innerHTML = html;
    });

    async function generatePDF() {
        const btn = document.getElementById('btnJana');
        btn.innerText = "Menjana PDF...";
        btn.disabled = true;
        
        const element = document.getElementById('pdf-content');
        const fileName = `Laporan Perhimpunan Minggu - ${document.getElementById('pvTarikh').innerText}.pdf`;

        const opt = {
            margin: 0,
            filename: fileName,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { 
                scale: 2, 
                useCORS: true, 
                width: 794, 
                windowWidth: 794, 
                scrollY: 0,
                scrollX: 0
            },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        try {
            await html2pdf().set(opt).from(element).save();
        } finally {
            btn.innerText = "MUAT TURUN PDF";
            btn.disabled = false;
        }
    }
    window.onload = updatePreview;
</script>
</body>
</html>
