<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Laporan Perhimpunan SJKC Chung San</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; background-color: #f0f2f5; padding: 20px; }
        .container { display: flex; flex-direction: column; gap: 20px; }
        
        @media (min-width: 992px) {
            .container { flex-direction: row; align-items: flex-start; }
            .form-area { width: 40%; position: sticky; top: 10px; max-height: 95vh; overflow-y: auto; }
            .preview-area { width: 60%; }
        }

        /* Bahagian Input */
        .form-area { background: white; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        label { font-weight: bold; display: block; margin-top: 15px; font-size: 0.9rem; color: #333; }
        
        input, textarea, select { 
            width: 100%; 
            padding: 12px; 
            margin-top: 5px; 
            border: 1px solid #ccc; 
            border-radius: 6px; 
            box-sizing: border-box; 
            font-size: 1rem;
        }

        /* Gaya Placeholder Kelabu */
        ::placeholder { color: #a9a9a9; opacity: 1; }
        :-ms-input-placeholder { color: #a9a9a9; }
        ::-ms-input-placeholder { color: #a9a9a9; }

        .btn-group { display: flex; gap: 10px; margin-top: 10px; }
        .btn-blue { background-color: #3498db; color: white; border: none; padding: 10px; border-radius: 6px; cursor: pointer; flex: 1; font-weight: bold; }
        .btn-green { background-color: #27ae60; color: white; border: none; padding: 15px; width: 100%; border-radius: 8px; cursor: pointer; font-size: 1.1rem; font-weight: bold; margin-top: 25px; }

        /* Gaya PDF (Standard A4 & Center) */
        .preview-area { background: #ddd; padding: 20px; display: flex; justify-content: center; }
        
        #pdf-content { 
            background: white; 
            width: 210mm; /* Lebar A4 */
            min-height: 297mm; 
            padding: 15mm; 
            box-sizing: border-box; 
            margin: 0 auto; /* Center secara horizontal */
        }

        .logo-box { text-align: center; margin-bottom: 10px; }
        .logo-box img { max-width: 110px; }
        
        h2 { text-align: center; text-decoration: underline; font-size: 18px; margin: 10px 0 20px 0; text-transform: uppercase; }
        
        /* Jadual seperti Excel */
        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        th, td { border: 1px solid black; padding: 10px; font-size: 13px; word-wrap: break-word; vertical-align: top; }
        th { background-color: #f2f2f2; width: 30%; text-align: left; font-weight: bold; }

        /* Muka surat baru untuk gambar */
        .photo-page { page-break-before: always; text-align: center; padding-top: 10mm; }
        .photo-grid { display: flex; flex-wrap: wrap; justify-content: center; gap: 15px; margin-top: 20px; }
        .img-wrapper { width: 45%; border: 1px solid #000; padding: 5px; background: #fff; }
        .img-wrapper img { width: 100%; height: 200px; object-fit: contain; }
    </style>
</head>
<body>

<div class="container">
    <div class="form-area">
        <h3 style="margin-top:0; color:#2c3e50;">Maklumat Laporan</h3>
        
        <label>Tarikh</label>
        <input type="text" id="tarikh" placeholder="12 Januari 2026">
        
        <label>Hari</label>
        <input type="text" id="hari" placeholder="Isnin">
        
        <label>Masa Mula</label>
        <input type="text" id="masa" placeholder="0940">

        <label>Senarai Staf Hadir (Pilihan Berbilang)</label>
        <select id="staf" multiple size="10"></select>
        <div class="btn-group">
            <button type="button" class="btn-blue" onclick="selectAllStaf()">Pilih Semua</button>
            <button type="button" class="btn-blue" style="background-color:#95a5a6" onclick="clearStaf()">Reset</button>
        </div>

        <label>Tema Sivik</label>
        <input type="text" id="tema" placeholder="Kasih Sayang/ Bertanggungjawab/ Kegembiraan/ Hormat-Menghormati">
        
        <label>Nama Pengacara</label>
        <input type="text" id="pengacara" placeholder="Nama Murid / Guru">

        <label>Ucapan Guru Besar</label>
        <textarea id="gb" placeholder="Ringkasan ucapan..."></textarea>
        
        <label>Ucapan GPK Pentadbiran</label>
        <textarea id="gpk_admin" placeholder="Ringkasan ucapan..."></textarea>
        
        <label>Ucapan GPK HEM</label>
        <textarea id="gpk_hem" placeholder="Ringkasan ucapan..."></textarea>
        
        <label>Ucapan GPK Kokurikulum</label>
        <textarea id="gpk_koku" placeholder="Ringkasan ucapan..."></textarea>
        
        <label>Ucapan Staf Lain</label>
        <textarea id="staf_lain" placeholder="Ringkasan ucapan..."></textarea>

        <label>Disediakan Oleh</label>
        <input type="text" id="disediakan" placeholder="Nama penyedia laporan">
        
        <label>Gambar Perhimpunan</label>
        <input type="file" id="inputPhotos" accept="image/*" multiple>

        <button class="btn-green" onclick="generatePDF()">JANA & MUAT TURUN PDF</button>
    </div>

    <div class="preview-area">
        <div id="pdf-content">
            <div class="logo-box">
                <img src="logo.png" alt="Logo Sekolah">
            </div>
            <h2>LAPORAN PERHIMPUNAN MINGGUAN</h2>
            
            <table>
                <tr><th>Tarikh</th><td id="pvTarikh"></td></tr>
                <tr><th>Hari</th><td id="pvHari"></td></tr>
                <tr><th>Masa Mula</th><td id="pvMasa"></td></tr>
                <tr><th>Kehadiran Guru/Staf</th><td id="pvStaf"></td></tr>
                <tr><th>Tema Sivik</th><td id="pvTema"></td></tr>
                <tr><th>Nama Pengacara</th><td id="pvPengacara"></td></tr>
                <tr><th>Ucapan Guru Besar</th><td id="pvGB"></td></tr>
                <tr><th>Ucapan GPK Pentadbiran</th><td id="pvGPKAdmin"></td></tr>
                <tr><th>Ucapan GPK HEM</th><td id="pvGPKHEM"></td></tr>
                <tr><th>Ucapan GPK Kokurikulum</th><td id="pvGPKKoku"></td></tr>
                <tr><th>Ucapan Staf Lain</th><td id="pvStafLain"></td></tr>
                <tr><th>Disediakan Oleh</th><td id="pvDisediakan"></td></tr>
                <tr><th>Disahkan Oleh</th><td><strong>Ling Lee Ann</strong><br>Guru Besar SJK(C) Chung San</td></tr>
            </table>

            <div id="photo-area" class="photo-page">
                <h3 style="text-decoration: underline;">LAMPIRAN GAMBAR</h3>
                <div id="pvPhotos" class="photo-grid">
                    <p style="color: #ccc; font-style: italic;">Gambar akan dipaparkan di sini.</p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    const stafList = ["Ling Lee Ann","Kong Zhe Fong","Fong Cui Fung","Cynthia Ting Xing Rou","Florence Wong Zhi Yu","Goh Su Ching","Lau Yun Hee","Roland Ting Hock Sing","Sharmaine Daphne Anak Slyvester Bakar","Stephen Hii Yii Nan","Tu Hiong Hiong","Unice Wong Wen Wen","Zafrullah Bin Mohd Sabri","Wong Chui Ling","Claudia Mo Ong Yi","Evy Law Jia Jia","Yuki Ng Jiajing","Wee Chun Yang","Efira Nazation Anak Kennedy","Faizah Binti Othman","Mariani Binti Haili","Stacy Wan"];

    const select = document.getElementById('staf');
    stafList.sort().forEach(s => select.add(new Option(s, s)));

    function selectAllStaf() {
        Array.from(select.options).forEach(opt => opt.selected = true);
        updatePreview();
    }
    function clearStaf() {
        Array.from(select.options).forEach(opt => opt.selected = false);
        updatePreview();
    }

    function updatePreview() {
        document.getElementById('pvTarikh').innerText = document.getElementById('tarikh').value || '-';
        document.getElementById('pvHari').innerText = document.getElementById('hari').value || '-';
        document.getElementById('pvMasa').innerText = document.getElementById('masa').value || '-';
        document.getElementById('pvTema').innerText = document.getElementById('tema').value || '-';
        document.getElementById('pvPengacara').innerText = document.getElementById('pengacara').value || '-';
        document.getElementById('pvGB').innerText = document.getElementById('gb').value || '-';
        document.getElementById('pvGPKAdmin').innerText = document.getElementById('gpk_admin').value || '-';
        document.getElementById('pvGPKHEM').innerText = document.getElementById('gpk_hem').value || '-';
        document.getElementById('pvGPKKoku').innerText = document.getElementById('gpk_koku').value || '-';
        document.getElementById('pvStafLain').innerText = document.getElementById('staf_lain').value || '-';
        document.getElementById('pvDisediakan').innerText = document.getElementById('disediakan').value || '-';

        const selected = Array.from(select.selectedOptions).map(o => o.value);
        document.getElementById('pvStaf').innerText = selected.length ? selected.join(", ") : "-";
    }

    document.querySelectorAll('input, textarea, select').forEach(el => el.addEventListener('input', updatePreview));

    document.getElementById('inputPhotos').addEventListener('change', async function(e) {
        const container = document.getElementById('pvPhotos');
        container.innerHTML = '';
        const files = Array.from(e.target.files);

        for (let i = 0; i < files.length; i++) {
            const reader = new FileReader();
            await new Promise(resolve => {
                reader.onload = (ev) => {
                    const div = document.createElement('div');
                    div.className = 'img-wrapper';
                    div.innerHTML = `<img src="${ev.target.result}"><p style="font-size:11px; margin:5px 0;">Gambar ${i+1}</p>`;
                    container.appendChild(div);
                    resolve();
                };
                reader.readAsDataURL(files[i]);
            });
        }
    });

    async function generatePDF() {
        updatePreview();
        const element = document.getElementById('pdf-content');
        const tarikhVal = document.getElementById('tarikh').value || 'Laporan';

        const opt = {
            margin: 0,
            filename: `Laporan Perhimpunan Sekolah ${tarikhVal}.pdf`,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        await html2pdf().set(opt).from(element).save();
    }

    window.onload = updatePreview;
</script>
</body>
</html>
