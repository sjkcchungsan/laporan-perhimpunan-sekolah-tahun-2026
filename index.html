<!DOCTYPE html>
<html lang="ms">
<head>
<meta charset="UTF-8">
<title>Laporan Perhimpunan Sekolah</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
    body { font-family: Arial, sans-serif; margin: 20px; background-color: #f0f2f5; }
    .container { display: flex; gap: 20px; }
    
    /* Bahagian Input */
    .form-area { width: 40%; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    
    /* Bahagian Preview - Di skrin nampak 60% */
    .preview-area { width: 60%; background: white; padding: 15px; border: 1px solid #ccc; min-height: 100vh; }
    
    /* CSS KHAS UNTUK PDF (PENTING) */
    /* Apabila menjana PDF, kita akan paksa elemen ini jadi lebar A4 standard */
    .export-pdf-style {
        width: 794px !important; /* Lebar tepat untuk A4 pada 96 DPI */
        padding: 40px !important;
        margin: 0 !important;
        box-shadow: none !important;
        border: none !important;
    }

    input, textarea, select, button { width: 100%; margin-bottom: 12px; padding: 10px; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
    label { font-weight: bold; display: block; margin-bottom: 5px; }

    /* Gaya Kandungan PDF */
    .pdf-content { width: 100%; color: black; }
    .logo-img { display: block; margin: 0 auto 10px; max-width: 120px; }
    h2 { text-align: center; text-decoration: underline; margin-bottom: 20px; font-size: 18px; }
    
    table { width: 100%; border-collapse: collapse; table-layout: fixed; }
    th, td { border: 1px solid black; padding: 10px; text-align: left; vertical-align: top; word-wrap: break-word; }
    th { width: 30%; background-color: #f9f9f9; }

    /* Gaya Gambar */
    .photo-grid { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px; justify-content: center; }
    .photo-item { width: 45%; border: 1px solid #ddd; padding: 5px; text-align: center; page-break-inside: avoid; }
    .photo-item img { width: 100%; height: 200px; object-fit: contain; }
    .page-break { page-break-before: always; }
</style>
</head>
<body>

<div class="container">
    <div class="form-area">
        <h2>Input Laporan</h2>
        <label>Tarikh</label><input type="text" id="tarikh" placeholder="Contoh: 2 Januari 2026">
        <label>Hari</label><input type="text" id="hari" placeholder="Contoh: Isnin">
        <label>Masa</label><input type="text" id="masa" placeholder="07:30 - 08:00">
        <label>Pilih Staf (Guna Ctrl untuk pilih banyak)</label>
        <select id="staf" multiple size="8"></select>
        <label>Tema</label><input type="text" id="tema">
        <label>Pengacara</label><input type="text" id="pengacara">
        <label>Ucapan Guru Besar</label><textarea id="gb"></textarea>
        <label>Lain-lain Ucapan</label><textarea id="lain"></textarea>
        <label>Disediakan Oleh</label><input type="text" id="disediakan">
        <label>Gambar (Maks 10)</label>
        <input type="file" id="photoInput" accept="image/*" multiple>
        
        <button onclick="generatePDF()" style="background: #28a745; color: white; font-weight: bold; cursor: pointer;">MUAT TURUN PDF</button>
    </div>

    <div class="preview-area" id="previewContainer">
        <div id="pdfContent" class="pdf-content">
            <img src="logo.png" class="logo-img" alt="Logo Sekolah">
            <h2>LAPORAN PERHIMPUNAN SEKOLAH</h2>
            <table>
                <tr><th>Tarikh</th><td id="pvTarikh"></td></tr>
                <tr><th>Hari</th><td id="pvHari"></td></tr>
                <tr><th>Masa</th><td id="pvMasa"></td></tr>
                <tr><th>Staf Hadir</th><td id="pvStaf"></td></tr>
                <tr><th>Tema</th><td id="pvTema"></td></tr>
                <tr><th>Pengacara</th><td id="pvPengacara"></td></tr>
                <tr><th>Ucapan Guru Besar</th><td id="pvGB"></td></tr>
                <tr><th>Lain-lain Ucapan</th><td id="pvLain"></td></tr>
                <tr><th>Disediakan Oleh</th><td id="pvDisediakan"></td></tr>
                <tr><th>Disahkan Oleh</th><td><strong>Ling Lee Ann</strong><br>Guru Besar SJK(C) Chung San</td></tr>
            </table>
            
            <div id="photoGallery" class="photo-grid"></div>
        </div>
    </div>
</div>

<script>
    const stafList = ["Ling Lee Ann","Kong Zhe Fong","Fong Cui Fung","Cynthia Ting Xing Rou","Florence Wong Zhi Yu","Goh Su Ching","Lau Yun Hee","Roland Ting Hock Sing","Sharmaine Daphne Anak Slyvester Bakar","Stephen Hii Yii Nan","Tu Hiong Hiong","Unice Wong Wen Wen","Zafrullah Bin Mohd Sabri","Wong Chui Ling","Claudia Mo Ong Yi","Evy Law Jia Jia","Yuki Ng Jiajing","Wee Chun Yang","Efira Nazation Anak Kennedy","Faizah Binti Othman","Mariani Binti Haili","Stacy Wan"];

    // Isi senarai staf
    const select = document.getElementById('staf');
    stafList.sort().forEach(s => {
        let opt = document.createElement('option');
        opt.value = opt.text = s;
        select.add(opt);
    });

    // Update preview secara automatik
    function updatePreview() {
        document.getElementById('pvTarikh').innerText = document.getElementById('tarikh').value;
        document.getElementById('pvHari').innerText = document.getElementById('hari').value;
        document.getElementById('pvMasa').innerText = document.getElementById('masa').value;
        document.getElementById('pvTema').innerText = document.getElementById('tema').value;
        document.getElementById('pvPengacara').innerText = document.getElementById('pengacara').value;
        document.getElementById('pvGB').innerText = document.getElementById('gb').value;
        document.getElementById('pvLain').innerText = document.getElementById('lain').value;
        document.getElementById('pvDisediakan').innerText = document.getElementById('disediakan').value;

        const selectedStaf = Array.from(select.selectedOptions).map(o => o.value);
        document.getElementById('pvStaf').innerText = selectedStaf.join(', ');
    }

    // Handle gambar
    document.getElementById('photoInput').addEventListener('change', function(e) {
        const gallery = document.getElementById('photoGallery');
        gallery.innerHTML = '';
        const files = e.target.files;

        Array.from(files).forEach((file, index) => {
            const reader = new FileReader();
            reader.onload = function(event) {
                const div = document.createElement('div');
                div.className = 'photo-item';
                // Tambah page break selepas 4 gambar
                if(index > 0 && index % 4 === 0) div.classList.add('page-break');
                
                div.innerHTML = `<img src="${event.target.result}"><p>Gambar ${index + 1}</p>`;
                gallery.appendChild(div);
            };
            reader.readAsDataURL(file);
        });
    });

    // Pasang listener pada semua input
    document.querySelectorAll('input, textarea, select').forEach(el => {
        el.addEventListener('input', updatePreview);
    });

    async function generatePDF() {
        const element = document.getElementById('pdfContent');
        const container = document.getElementById('previewContainer');

        // LANGKAH 1: Paksa saiz A4 sebelum jana
        container.classList.add('export-pdf-style');

        const opt = {
            margin: [10, 10, 10, 10],
            filename: 'Laporan_Perhimpunan.pdf',
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true, letterRendering: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };

        // LANGKAH 2: Jana PDF
        try {
            await html2pdf().set(opt).from(element).save();
        } finally {
            // LANGKAH 3: Kembalikan gaya asal selepas siap
            container.classList.remove('export-pdf-style');
        }
    }
</script>
</body>
</html>
